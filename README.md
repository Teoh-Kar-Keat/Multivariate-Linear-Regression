# 汽車價格預測專案 — CRISP-DM 詳細報告（正式版）

---

## 摘要

本專案目標為建立二手汽車價格預測模型，協助二手車商、平台買家及內部產品做即時估價與建議。

方法遵循 CRISP-DM 流程：資料取得 → 清洗 → 特徵工程 → 建模 → 評估 → 部署。

關鍵發現：車齡、里程、品牌/車系與車況為主要影響因子；非線性模型通常表現優於單純線性模型；資料偏態與極端值需特別處理。

建議：建立資料品質監控與模型監測機制，並持續收集額外欄位（如地區、維修紀錄）以提升模型準確性與公平性。

---

## 1. 商業理解（Business Understanding）

| 項目 | 方法/操作 | 原因/目的 |
| --- | --- | --- |
| 商業目標 | 預測二手車價格，MAE ≦ 平均價格 10%，R² ≧ 0.6 | 將商業目標量化成可衡量技術指標，方便模型開發與評估 |
| 利害關係人 | 二手車商（快速估價）、平台買家（參考價）、內部產品（API 嵌入） | 確保模型開發符合實際使用情境，減少落差 |
| 可解釋性 | 提供全局特徵重要性及局部解釋（如 SHAP） | 便於業務理解價格驅動因素，增加信任度 |
| 風險控制 | 避免系統性偏差（品牌/區域） | 保護特定族群車輛估價公平性，降低商業風險 |

---

## 2. 資料理解（Data Understanding）

| 項目 | 方法/操作 | 原因/目的 |
| --- | --- | --- |
| 資料來源 | [Kaggle CarPrice 資料集](https://www.kaggle.com/datasets/sidharth178/car-prices-dataset) | 提供完整欄位與範例，方便快速 EDA |
| 欄位檢視 | price、CarName、fueltype、aspiration、doornumber、carbody、drivewheel、enginelocation、enginesize、horsepower、citympg、highwaympg… | 確認目標與特徵，識別需處理的欄位 |
| 缺失值處理 | 特殊標記如 "?" 轉 NaN，數值欄位以中位數填補，類別欄位以眾數填補 | 確保資料完整性，避免模型因缺失值錯誤訓練 |
| 目標變數分布 | price 右偏，mean=13276.71, median=10295 | 採 log(price) 或 percentile-based 指標，可減少極端值對模型影響 |
| 類別特徵分布 | fueltype gas/diesel, carbody sedan/hatchback/wagon/... | 辨識高基數欄位，決定編碼策略 |
| 特徵工程初步 | One-Hot Encoding, X_train (164,190), X_test (41,190) | 編碼後模型可直接使用，但高維需注意過擬合 |

---

## 3. 資料準備（Data Preparation）

| 步驟 | 操作方法 | 原因/目的 |
| --- | --- | --- |
| 缺失值處理 | 數值欄位中位數填補，類別欄位眾數填補或標註 Unknown | 避免資料缺失導致模型無法訓練，維持統計穩定性 |
| 異常值處理 | IQR / z-score 偵測，capping 或移除明顯錯誤值 | 極端值影響線性模型與評估指標，但保留真實極值以維持商業資訊完整性 |
| 類別欄位編碼 | One-Hot Encoding（低基數）、Target Encoding（高基數）、頻次編碼 | 提高模型表現並控制維度爆炸，避免洩漏 |
| 特徵衍生 | age = current_year - year, mileage_per_year, brand_group, service_flag… | 將隱性關係明確化，增加模型可學習訊號 |
| 數值特徵標準化 | StandardScaler / MinMaxScaler | 線性模型與距離敏感模型需要統一尺度，提升穩定性 |
| 資料切分 | Train/Test 80/20 或 70/15/15，時間序列需採時間切分 | 確保模型泛化能力與避免資訊洩漏 |

---

## 4. 特徵選擇與分析

1. **絕對相關係數**
    
    計算每個特徵與價格的 Pearson 絕對相關係數，選出前 20 個。
    
    高相關特徵通常包含品牌、車型、引擎大小等。
    
2. **SelectKBest**
    
    使用 F-test 選出最能解釋價格變異的前 20 個特徵。
    
    包含車身尺寸、引擎特徵和燃油效率，符合直覺。
    
3. **LassoCV**
    
    利用 L1 正則化篩選非零係數特徵，篩選出 5 個。
    
    自動排除對價格影響不大或高度共線的特徵，簡化模型。
    
4. **RFE（遞迴特徵消去）**
    
    搭配線性模型，逐步去除對價格影響較小的特徵，選出前 15 特徵。
    
    多數選出的特徵為車型和引擎類別，顯示品牌影響力大。
    
5. **綜合特徵**
    
    將各方法選出的特徵整合，取前 20 個，形成「綜合特徵」集合。
    
    兼顧線性與非線性關係，保留重要資訊。
    

---

## 5. 模型建立與評估

### 5.1 測試模型

- LinearRegression、Ridge、Lasso
- RandomForestRegressor、GradientBoostingRegressor

### 5.2 評估指標

- **MSE**（均方誤差）：衡量整體誤差
- **MAE**（平均絕對誤差）：直觀了解誤差
- **R²**（決定係數）：解釋變異百分比

### 5.3 結果摘要

| 特徵組合 | 模型 | MSE | MAE | R² |
| --- | --- | --- | --- | --- |
| 標準化高相關特徵 | 隨機森林 | 1.69e7 | 2,445 | 0.786 |
| 高相關特徵 | 隨機森林 | 1.78e7 | 2,594 | 0.774 |
| 綜合特徵 | GBDT | 2.32e7 | 2,937 | 0.707 |
| 綜合特徵 | 隨機森林 | 2.48e7 | 2,780 | 0.686 |
| 綜合特徵 | Ridge | 6.44e7 | 5,549 | 0.184 |
| 綜合特徵 | Lasso | 6.85e7 | 5,614 | 0.132 |

最佳模型：**標準化高相關特徵 + 隨機森林**

- MAE / 平均價格 ≈ 18.1%
- MAE / 標準差 ≈ 27.2%

**訓練策略**：Pipeline（填補 → 編碼 → 標準化 → 特徵衍生 → 模型）、K-fold CV、Target encoding 在 CV 內操作避免洩漏。

**超參數調整**：Grid / Random / Bayesian search，優化目標以 MAE / R²。

### 5.4 預測效果可視化

- 散點圖：預測 vs 實際價格，點接近 y=x，擬合良好
- 直方圖：目標變數價格集中在中低端，少數極端高價車
- 極端值測試：人為翻倍測試集最大值，R² ≈0.78，模型穩健

---

## 6. 評估（Evaluation）

| 步驟 | 方法 | 原因/目的 |
| --- | --- | --- |
| 指標選擇 | MAE、MSE、RMSE、R²、Calibration | 平衡業務直觀性與極端值敏感性 |
| 交叉驗證 | k-fold（k=5/10） | 量化模型不確定性，確保穩定性 |
| 錯誤分析 | 按 price、品牌、車齡分群，殘差圖、Top-N 高誤差案例 | 發現系統性偏差，調整模型或業務策略 |
| 穩定性測試 | 加入極端值、時間序列測試、對抗測試 | 確保模型在真實世界輸入不完美時仍可靠 |

---

## 7. 部署與維運（Deployment & Maintenance）

| 項目 | 方法 | 原因/目的 |
| --- | --- | --- |
| 部署架構 | API（REST/GRPC）、Docker + K8s、Batch pipeline | 支援即時與批次估價，確保擴展性 |
| 模型版本管控 | MLflow / S3 + Git | 管控版本，便於回溯與重訓 |
| 監控 | 資料品質、模型效能、分布漂移、API 延遲 | 及早發現異常，降低商業風險 |
| 重訓政策 | 定期或事件觸發重訓，CI/CD 自動化 | 保持模型精度與穩定性 |
| 隱私安全 | 個資脫敏，法規遵循 | 保護用戶隱私，避免法律風險 |

---

## 8. 商業影響與後續建議

- 自動估價節省工時，提升交易效率
- 上線建議：「估價區間 + 預測值」降低單一錯誤風險
- 收集更多成交價格、維修歷史、事故紀錄
- 引入車輛圖像做 multimodal 模型
- 開發可解釋客製化功能，支援業務策略調整

---

## 9. 結語

本報告依 **CRISP-DM** 全面拆解汽車價格預測專案，整合每個步驟的操作方法與原因，提供：

1. 商業目標明確化
2. 資料檢視與處理策略
3. 模型選擇、訓練、調參與評估
4. 部署、監控與重訓流程

確保資料工程師與業務團隊能直接執行，並保證模型在真實商業環境中穩定可靠。
