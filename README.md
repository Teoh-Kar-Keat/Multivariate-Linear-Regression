
# 汽車價格預測專案：CRISP-DM 流程詳細報告

---

## 1. Business Understanding

### 目標與動機
本專案旨在建立一個能夠預測二手汽車價格的機器學習模型，協助二手車商、買家或平台根據車輛特徵快速、合理地評估車價。透過數據分析與模型建構，提升定價效率並減少人為主觀誤差。

### 問題定義
- 如何根據汽車的多種屬性（如品牌、年份、里程、引擎大小等）預測其合理售價？
- 模型需兼顧準確性與解釋性，並能對異常值具備一定魯棒性。

---

## 2. Data Understanding

### 資料來源與內容
- **來源**：Kaggle - Car Price Prediction Dataset
- **內容**：包含多種汽車屬性（品牌、年份、里程、引擎大小、燃料類型、變速箱、車身型式等）及其實際成交價格。

### 初步檢查步驟
1. **欄位與型態檢查**：
    - 以 `df.columns`、`df.dtypes` 檢查所有欄位與資料型態。
2. **缺失值統計**：
    - 以 `df.isna().sum()` 檢查每欄缺失情形。
3. **數值欄位描述統計**：
    - 以 `df.describe()` 觀察均值、標準差、最大/最小值。
4. **類別欄位分布**：
    - 以 `value_counts()` 觀察各類別欄位的分布。

### 實作與發現
- 發現部分欄位有缺失值，且有些數值型欄位被誤讀為 object。
- 目標變數（price）分布偏態，存在極端高價。

---

## 3. Data Preparation

### 缺失值處理
- 數值欄位以中位數填補，類別欄位以眾數填補。
- 以 `df.replace("?", np.nan)` 處理特殊缺失值標記。

### 資料型態轉換
- 將 object 欄位嘗試轉為數值型態，無法轉換者保留為類別。

### 特徵工程
1. **One-Hot Encoding**：
    - 對所有類別型欄位進行 one-hot 編碼，避免多重共線性（drop_first=True）。
2. **特徵選擇**：
    - 以多種方法選出重要特徵：
        - Pearson 相關係數
        - SelectKBest（F-test）
        - LassoCV（L1 正則化）
        - RFE（遞迴特徵消去）
    - 綜合上述方法，取前 10~20 個最重要特徵。

### 資料切分
- 以 `train_test_split` 將資料分為 80% 訓練集、20% 測試集。

### 實作與討論
- 缺失值與型態處理確保後續建模不會出錯。
- 特徵選擇提升模型效率與泛化能力。

---

## 4. Modeling

### 模型建構流程
1. **模型選擇**：
    - 線性回歸、Ridge、Lasso、隨機森林、GBDT
2. **特徵組合**：
    - 綜合特徵、高相關特徵、標準化高相關特徵
3. **自動化比較**：
    - 以迴圈自動比較多種模型與特徵組合，計算 MSE、MAE、R²，並以表格呈現。
4. **最佳模型選擇**：
    - 以 R² 最高者為最佳組合，並繪製預測 vs. 實際值散點圖。

### 交叉驗證與極端值測試
1. **5-fold Cross-Validation**：
    - 以 `cross_val_score` 驗證最佳模型的穩定性，觀察 R² 分數分布。
2. **極端值測試**：
    - 人為將測試集一筆目標值設為極端高，觀察模型對異常值的敏感度。

### 實作與討論
- 隨機森林與 GBDT 等非線性模型表現優於線性模型。
- 標準化高相關特徵組合通常能提升模型表現。
- 交叉驗證平均 R² 約 0.64，顯示模型泛化能力尚可。
- 加入極端值後，R² 明顯下降，MSE/MAE 上升，模型對異常值有一定敏感度。

---

## 5. Evaluation

### 模型評估指標
- **MSE（均方誤差）**：衡量預測值與實際值的平方差。
- **MAE（平均絕對誤差）**：衡量預測值與實際值的絕對差。
- **R²（決定係數）**：衡量模型對變異的解釋能力。

### 測試集與交叉驗證結果
- 最佳模型（如：隨機森林 + 標準化高相關特徵）
- 5-fold 交叉驗證 R² 平均約 0.64

### 誤差與目標變數分布比較
- 目標變數（測試集）平均值：約 $15,000$
- 標準差：約 $7,000$
- MAE/平均值比例：約 8.2%
- MAE/標準差比例：約 17.6%

### 極端值影響
- 加入極端值後，R² 降至 0.45，MSE/MAE 明顯上升，顯示模型對異常值有一定敏感度。

### 可視化
- 預測 vs. 實際值散點圖：大多數預測落於理想線附近，極端值偏離明顯。
- 目標變數分布直方圖：顯示價格分布偏態。
- 信賴區間圖：以 statsmodels OLS 計算預測信賴區間。

### 討論
- 模型整體表現良好，能有效預測大部分車輛價格。
- 對極端值敏感，建議未來可進行異常值偵測或採用更魯棒的損失函數。

---

## 6. Deployment

### 應用場景
- 可將模型部署於二手車平台，提供即時車價預測服務。
- 可用於批量評估庫存車輛價值，輔助決策。

### 後續建議
- 持續收集新數據、定期重訓模型。
- 加入更多特徵（如地區、維修紀錄等）。
- 進行超參數優化與特徵工程提升預測準確度。
- 加入異常值偵測與解釋型 AI 工具，提升模型信賴度。

---

> 本報告依據 CRISP-DM 流程，逐步對應 notebook 各階段實作，詳細記錄資料理解、處理、建模、評估與應用建議，並以實際數據與圖表佐證模型表現。每一階段均有明確程式步驟、分析與討論，便於未來維護與擴充。
